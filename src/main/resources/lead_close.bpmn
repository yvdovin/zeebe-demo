<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_0z91dmx" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.7.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.1.0"><bpmn:process id="close_lead_by_id" name="Закрытие лида" isExecutable="true"><bpmn:startEvent id="StartEvent_1"><bpmn:extensionElements><zeebe:ioMapping><zeebe:output source="=id" target="lead_id" /><zeebe:output source="=userId" target="user_id" /><zeebe:output source="=payload.new.action" target="action" /><zeebe:output source="=if is defined(payload.new.deactivationReason) then payload.new.deactivationReason else null" target="deactivation_reason" /></zeebe:ioMapping></bpmn:extensionElements><bpmn:outgoing>Flow_1c7xieb</bpmn:outgoing></bpmn:startEvent><bpmn:exclusiveGateway id="Gateway_15w3hrc"><bpmn:incoming>Flow_1c7xieb</bpmn:incoming><bpmn:outgoing>Flow_0laeg19</bpmn:outgoing><bpmn:outgoing>Flow_0a4usgz</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_1c7xieb" sourceRef="StartEvent_1" targetRef="Gateway_15w3hrc" /><bpmn:sequenceFlow id="Flow_0laeg19" sourceRef="Gateway_15w3hrc" targetRef="Activity_0oddn0t"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=action = "conversion_lead_out"</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:endEvent id="Event_0kxx26l"><bpmn:incoming>Flow_0iwoh52</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_0iwoh52" sourceRef="Activity_0oddn0t" targetRef="Event_0kxx26l" /><bpmn:serviceTask id="Activity_121z9z9" name="Получить данные лида"><bpmn:extensionElements><zeebe:taskDefinition type="http_request" /><zeebe:ioMapping><zeebe:input source="=&#34;{\&#34;query\&#34;:\&#34;query getByIdLead ($id: BigInteger) {     getByIdLead (id: $id) {         comment         companyId         companyName         createdAt         createdBy         eventId         expectedRevenue         expectedSignDate         id         industry {             code             dictionaryCode         }         jobTitle         name         opportunityId         phoneNumber         productOfInterest {             code             dictionaryCode         }         source {             code             dictionaryCode         }         stage {             code             dictionaryCode         }         status {             code             dictionaryCode         }         updatedAt         updatedBy         workEmail     } }\&#34;,\&#34;variables\&#34;:{\&#34;id\&#34;:&#34;+ string(lead_id) +&#34;}}&#34;" target="body" /><zeebe:input source="=&#34;POST&#34;" target="method" /><zeebe:input source="=&#34;api-gateway&#34;" target="service" /><zeebe:output source="=data.getByIdLead.name" target="name" /><zeebe:output source="=data.getByIdLead.companyId" target="company_id" /><zeebe:output source="=data.getByIdLead.expectedSignDate" target="expetced_sign_date" /><zeebe:output source="=data.getByIdLead.source.code" target="lead_source" /><zeebe:output source="=data.getByIdLead.expectedRevenue" target="expected_revenue" /></zeebe:ioMapping></bpmn:extensionElements><bpmn:incoming>Flow_0a4usgz</bpmn:incoming><bpmn:outgoing>Flow_1r02kht</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_0oddn0t" name="Закрыть лид проигрышем"><bpmn:extensionElements><zeebe:taskDefinition type="http_request" /><zeebe:ioMapping><zeebe:input source="=&#34;api-gateway&#34;" target="service" /><zeebe:input source="=&#34;POST&#34;" target="method" /><zeebe:input source="=&#34;{\&#34;query\&#34;:\&#34;mutation updateByIdLead ($id: BigInteger, $lead: UpdateLeadManagementByIdInput) {\n    updateByIdLead (id: $id, lead: $lead) {\n        message\n    }\n}\&#34;,\&#34;variables\&#34;:{\&#34;id\&#34;:&#34; + string(lead_id) + &#34;,\&#34;lead\&#34;:{\&#34;deactivationReason\&#34;:\&#34;&#34;+ string(deactivation_reason) +&#34;\&#34;,\&#34;status\&#34;:\&#34;out\&#34;}}}&#34;" target="body" /></zeebe:ioMapping></bpmn:extensionElements><bpmn:incoming>Flow_0laeg19</bpmn:incoming><bpmn:outgoing>Flow_0iwoh52</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_1lhdtgm" name="Закрыть лид выигрышем"><bpmn:extensionElements><zeebe:taskDefinition type="http_request" /><zeebe:ioMapping><zeebe:input source="=&#34;POST&#34;" target="method" /><zeebe:input source="=&#34;{\&#34;query\&#34;:\&#34;mutation updateByIdLead ($id: BigInteger, $lead: UpdateLeadManagementByIdInput) {\n    updateByIdLead (id: $id, lead: $lead) {\n        message\n    }\n}\&#34;,\&#34;variables\&#34;:{\&#34;id\&#34;:&#34; + string(lead_id) + &#34;,\&#34;lead\&#34;:{\&#34;status\&#34;:\&#34;converted\&#34;}}}&#34;" target="body" /><zeebe:input source="=&#34;api-gateway&#34;" target="service" /></zeebe:ioMapping></bpmn:extensionElements><bpmn:incoming>Flow_16yl8l9</bpmn:incoming><bpmn:outgoing>Flow_0zhh630</bpmn:outgoing></bpmn:serviceTask><bpmn:serviceTask id="Activity_00jqlta" name="Создать сделку"><bpmn:extensionElements><zeebe:taskDefinition type="http_request" /><zeebe:ioMapping><zeebe:input source="=&#34;POST&#34;" target="method" /><zeebe:input source="=&#34;opportunity-service&#34;" target="service" /><zeebe:input source="=&#34;{\&#34;name\&#34;:\&#34; &#34;+ string(name) +&#34; \&#34;,\&#34;stage\&#34;:\&#34;01\&#34;,\&#34;probabilityForOppStage\&#34;:null,\&#34;companyId\&#34;:&#34;+ string(company_id) +&#34;,\&#34;finalCompanyId\&#34;:&#34;+ string(company_id) +&#34;,\&#34;currency\&#34;:\&#34;810\&#34;,\&#34;expectedSignDate\&#34;:\&#34;&#34;+ string(expetced_sign_date) +&#34;\&#34;,\&#34;competenceCentre\&#34;:\&#34;pro\&#34;,\&#34;opportunityType\&#34;:null,\&#34;probability\&#34;:null,\&#34;probabilityBr\&#34;:null,\&#34;legalEntity\&#34;:\&#34;tvc\&#34;,\&#34;estimatedMarginality\&#34;:null,\&#34;expectedRevenue\&#34;:&#34;+ string(expected_revenue) +&#34;,\&#34;vatIncluded\&#34;:true,\&#34;war\&#34;:false,\&#34;requestType\&#34;:null,\&#34;submissionDate\&#34;:null,\&#34;approved\&#34;:null,\&#34;transferred\&#34;:null,\&#34;prepareOffer\&#34;:null,\&#34;prepareContract\&#34;:null,\&#34;status\&#34;:\&#34;open\&#34;,\&#34;leadSource\&#34;:\&#34;&#34;+ string(lead_source) +&#34;\&#34;,\&#34;reasonLost\&#34;:null,\&#34;closeComment\&#34;:null,\&#34;closeAction\&#34;:null,\&#34;direction\&#34;:null,\&#34;initiator\&#34;:&#34;+ string(initiator) +&#34;,\&#34;type\&#34;:\&#34;opportunity\&#34;,\&#34;opportunityChildNumber\&#34;:null}&#34;" target="body" /><zeebe:input source="=&#34;opportunities&#34;" target="uri" /><zeebe:output source="=status" target="status_opp" /><zeebe:output source="=payload" target="answer_opp" /></zeebe:ioMapping></bpmn:extensionElements><bpmn:incoming>Flow_0zhh630</bpmn:incoming><bpmn:outgoing>Flow_0dt60rm</bpmn:outgoing></bpmn:serviceTask><bpmn:sequenceFlow id="Flow_16yl8l9" sourceRef="Activity_1wlnm1o" targetRef="Activity_1lhdtgm" /><bpmn:sequenceFlow id="Flow_0zhh630" sourceRef="Activity_1lhdtgm" targetRef="Activity_00jqlta" /><bpmn:serviceTask id="Activity_1tk4zmn" name="Добавить связь с лидом"><bpmn:extensionElements><zeebe:taskDefinition type="http_request" /><zeebe:ioMapping><zeebe:input source="=&#34;{\&#34;query\&#34;:\&#34;mutation updateByIdLead ($id: BigInteger, $lead: UpdateLeadManagementByIdInput) {\n    updateByIdLead (id: $id, lead: $lead) {\n        message\n    }\n}\&#34;,\&#34;variables\&#34;:{\&#34;id\&#34;:&#34; + string(lead_id) + &#34;,\&#34;lead\&#34;:{\&#34;opportunityId\&#34;: &#34;+ string(answer_opp.id) +&#34;}}}&#34;" target="body" /><zeebe:input source="=&#34;api-gateway&#34;" target="service" /><zeebe:input source="=&#34;POST&#34;" target="method" /></zeebe:ioMapping></bpmn:extensionElements><bpmn:incoming>Flow_0na4pfl</bpmn:incoming><bpmn:outgoing>Flow_0h9c6qn</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_1e1319u"><bpmn:incoming>Flow_0h9c6qn</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_0h9c6qn" sourceRef="Activity_1tk4zmn" targetRef="Event_1e1319u" /><bpmn:serviceTask id="Activity_0ebkeml" name="Открыть лид"><bpmn:extensionElements><zeebe:ioMapping><zeebe:input source="=&#34;{\&#34;query\&#34;:\&#34;mutation updateByIdLead ($id: BigInteger, $lead: UpdateLeadManagementByIdInput) {\n    updateByIdLead (id: $id, lead: $lead) {\n        message\n    }\n}\&#34;,\&#34;variables\&#34;:{\&#34;id\&#34;:&#34; + string(lead_id) + &#34;,\&#34;lead\&#34;:{\&#34;status\&#34;:\&#34;in_process\&#34;}}}&#34;" target="body" /><zeebe:input source="=&#34;POST&#34;" target="method" /><zeebe:input source="=&#34;api-gateway&#34;" target="service" /></zeebe:ioMapping><zeebe:taskDefinition type="http_request" /></bpmn:extensionElements><bpmn:incoming>Flow_1eo7brr</bpmn:incoming><bpmn:outgoing>Flow_0pzfgyx</bpmn:outgoing></bpmn:serviceTask><bpmn:endEvent id="Event_00ii1ha"><bpmn:incoming>Flow_0pzfgyx</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="Flow_0pzfgyx" sourceRef="Activity_0ebkeml" targetRef="Event_00ii1ha" /><bpmn:exclusiveGateway id="Gateway_02a3yf4" default="Flow_1eo7brr"><bpmn:incoming>Flow_0dt60rm</bpmn:incoming><bpmn:outgoing>Flow_1eo7brr</bpmn:outgoing><bpmn:outgoing>Flow_0na4pfl</bpmn:outgoing></bpmn:exclusiveGateway><bpmn:sequenceFlow id="Flow_0dt60rm" sourceRef="Activity_00jqlta" targetRef="Gateway_02a3yf4" /><bpmn:sequenceFlow id="Flow_1eo7brr" sourceRef="Gateway_02a3yf4" targetRef="Activity_0ebkeml" /><bpmn:sequenceFlow id="Flow_0na4pfl" sourceRef="Gateway_02a3yf4" targetRef="Activity_1tk4zmn"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=status_opp != "Error"</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="Flow_0a4usgz" sourceRef="Gateway_15w3hrc" targetRef="Activity_121z9z9"><bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=action = "conversion_lead_success"</bpmn:conditionExpression></bpmn:sequenceFlow><bpmn:sequenceFlow id="Flow_1r02kht" sourceRef="Activity_121z9z9" targetRef="Activity_1wlnm1o" /><bpmn:serviceTask id="Activity_1wlnm1o" name="Получить позицию пользователя"><bpmn:extensionElements><zeebe:taskDefinition type="http_request" /><zeebe:ioMapping><zeebe:input source="=&#34;{\&#34;query\&#34;:\&#34;query filterUsers ($orderBy: UserFilterOrderBy!, $sortType: UserFilterSortType!, $limit: Int!, $offset: Int!, $request: FilterUserRequest!) {     filterUsers (orderBy: $orderBy, sortType: $sortType, limit: $limit, offset: $offset, request: $request) {         users {             id             positions {                 id             }         }         count     } }\&#34;,\&#34;variables\&#34;:{\&#34;orderBy\&#34;:\&#34;id\&#34;,\&#34;sortType\&#34;:\&#34;asc\&#34;,\&#34;limit\&#34;:10,\&#34;offset\&#34;:0,\&#34;request\&#34;:{\&#34;listFilters\&#34;:{\&#34;name\&#34;:\&#34;id\&#34;,\&#34;values\&#34;:{\&#34;predicate\&#34;:\&#34;IN\&#34;,\&#34;value\&#34;:[&#34;+ string(user_id) +&#34;]}},\&#34;booleanFilters\&#34;:{\&#34;name\&#34;:\&#34;userPositionChosen\&#34;,\&#34;values\&#34;:[{\&#34;predicate\&#34;:\&#34;EQUALS\&#34;,\&#34;value\&#34;:true}]}}}}&#34;" target="body" /><zeebe:input source="=&#34;POST&#34;" target="method" /><zeebe:input source="=&#34;api-gateway&#34;" target="service" /><zeebe:output source="=data.filterUsers.users.positions[1].id[1]" target="initiator" /></zeebe:ioMapping></bpmn:extensionElements><bpmn:incoming>Flow_1r02kht</bpmn:incoming><bpmn:outgoing>Flow_16yl8l9</bpmn:outgoing></bpmn:serviceTask></bpmn:process><bpmn:error id="Error_0u5q1j8" name="Error_2ap2q2v" /><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="close_lead_by_id"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds x="152" y="219" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_15w3hrc_di" bpmnElement="Gateway_15w3hrc" isMarkerVisible="true"><dc:Bounds x="275" y="212" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_0kxx26l_di" bpmnElement="Event_0kxx26l"><dc:Bounds x="712" y="332" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_13nne8q_di" bpmnElement="Activity_121z9z9"><dc:Bounds x="390" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0digjpw_di" bpmnElement="Activity_0oddn0t"><dc:Bounds x="550" y="310" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_10proy7_di" bpmnElement="Activity_1lhdtgm"><dc:Bounds x="810" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0w5wa1e_di" bpmnElement="Activity_00jqlta"><dc:Bounds x="1040" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_1ih6i1d_di" bpmnElement="Activity_1tk4zmn"><dc:Bounds x="1370" y="80" width="100" height="80" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_1e1319u_di" bpmnElement="Event_1e1319u"><dc:Bounds x="1542" y="102" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0z8pmln_di" bpmnElement="Activity_0ebkeml"><dc:Bounds x="1330" y="210" width="100" height="80" /><bpmndi:BPMNLabel /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Event_00ii1ha_di" bpmnElement="Event_00ii1ha"><dc:Bounds x="1512" y="232" width="36" height="36" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Gateway_02a3yf4_di" bpmnElement="Gateway_02a3yf4" isMarkerVisible="true"><dc:Bounds x="1215" y="95" width="50" height="50" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="Activity_0fm1cte_di" bpmnElement="Activity_1wlnm1o"><dc:Bounds x="600" y="80" width="100" height="80" /><bpmndi:BPMNLabel /></bpmndi:BPMNShape><bpmndi:BPMNEdge id="Flow_1c7xieb_di" bpmnElement="Flow_1c7xieb"><di:waypoint x="188" y="237" /><di:waypoint x="275" y="237" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0laeg19_di" bpmnElement="Flow_0laeg19"><di:waypoint x="300" y="262" /><di:waypoint x="300" y="350" /><di:waypoint x="550" y="350" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0iwoh52_di" bpmnElement="Flow_0iwoh52"><di:waypoint x="650" y="350" /><di:waypoint x="712" y="350" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_16yl8l9_di" bpmnElement="Flow_16yl8l9"><di:waypoint x="700" y="120" /><di:waypoint x="810" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0zhh630_di" bpmnElement="Flow_0zhh630"><di:waypoint x="910" y="120" /><di:waypoint x="1040" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0h9c6qn_di" bpmnElement="Flow_0h9c6qn"><di:waypoint x="1470" y="120" /><di:waypoint x="1542" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0pzfgyx_di" bpmnElement="Flow_0pzfgyx"><di:waypoint x="1430" y="250" /><di:waypoint x="1512" y="250" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0dt60rm_di" bpmnElement="Flow_0dt60rm"><di:waypoint x="1140" y="120" /><di:waypoint x="1215" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1eo7brr_di" bpmnElement="Flow_1eo7brr"><di:waypoint x="1240" y="145" /><di:waypoint x="1240" y="250" /><di:waypoint x="1330" y="250" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0na4pfl_di" bpmnElement="Flow_0na4pfl"><di:waypoint x="1265" y="120" /><di:waypoint x="1370" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_0a4usgz_di" bpmnElement="Flow_0a4usgz"><di:waypoint x="300" y="212" /><di:waypoint x="300" y="120" /><di:waypoint x="390" y="120" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="Flow_1r02kht_di" bpmnElement="Flow_1r02kht"><di:waypoint x="490" y="120" /><di:waypoint x="600" y="120" /></bpmndi:BPMNEdge></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>